<!DOCTYPE html>
<html lang="en-US">
    <head>
        <meta charset="utf-8"> 
        <meta http-equiv="X-UA-Compatible" content="IE=edge">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <meta name="author" content="Michael" />
        <meta name="copyright" content="Michael" />

        <meta property="og:type" content="article" />
        <meta name="twitter:card" content="summary">

<meta name="keywords" content="BeautifulSoup, Javascript, Requests, Scraping, Selenium, Python, " />

<meta property="og:title" content="Scraping JavaScript pages with Python: Selenium, Requests, and Beautiful Soup "/>
<meta property="og:url" content="/scraping-javascript-pages-with-python-selenium.html" />
<meta property="og:description" content="Note: Imgur has an API. Please use the API if you intend to gather images from Imgur. This post is a short demonstration of scraping JavaScript webpages that are not possible to scrape with Beautiful Soup or Requests by themselves. While imgur has an API, the thought occurred that perhaps ..." />
<meta property="og:site_name" content="Caffeine Industries" />
<meta property="og:article:author" content="Michael" />
<meta property="og:article:published_time" content="2015-12-03T23:08:00-07:00" />
<meta name="twitter:title" content="Scraping JavaScript pages with Python: Selenium, Requests, and Beautiful Soup ">
<meta name="twitter:description" content="Note: Imgur has an API. Please use the API if you intend to gather images from Imgur. This post is a short demonstration of scraping JavaScript webpages that are not possible to scrape with Beautiful Soup or Requests by themselves. While imgur has an API, the thought occurred that perhaps ...">

        <title>Scraping JavaScript pages with Python: Selenium, Requests, and Beautiful Soup  · Caffeine Industries
</title>
        <link href="//netdna.bootstrapcdn.com/twitter-bootstrap/2.3.2/css/bootstrap-combined.min.css" rel="stylesheet">
        <link href="//netdna.bootstrapcdn.com/font-awesome/4.0.1/css/font-awesome.css" rel="stylesheet">
        <link rel="stylesheet" type="text/css" href="/theme/css/pygments.css" media="screen">
        <link rel="stylesheet" type="text/css" href="/theme/tipuesearch/tipuesearch.css" media="screen">
        <link rel="stylesheet" type="text/css" href="/theme/css/elegant.css" media="screen">
        <link rel="stylesheet" type="text/css" href="/theme/css/custom.css" media="screen">
    </head>
    <body>
        <div id="content-sans-footer">
        <div class="navbar navbar-static-top">
            <div class="navbar-inner">
                <div class="container-fluid">
                    <a class="btn btn-navbar" data-toggle="collapse" data-target=".nav-collapse">
                        <span class="icon-bar"></span>
                        <span class="icon-bar"></span>
                        <span class="icon-bar"></span>
                    </a>
                    <a class="brand" href="/"><span class=site-name>Caffeine Industries</span></a>
                    <div class="nav-collapse collapse">
                        <ul class="nav pull-right top-menu">
                            <li ><a href="">Home</a></li>
                            <li ><a href="/categories.html">Categories</a></li>
                            <li ><a href="/tags.html">Tags</a></li>
                            <li ><a href="/archives.html">Archives</a></li>
                            <li><form class="navbar-search" action="/search.html" onsubmit="return validateForm(this.elements['q'].value);"> <input type="text" class="search-query" placeholder="Search" name="q" id="tipue_search_input"></form></li>
                        </ul>
                    </div>
                </div>
            </div>
        </div>
        <div class="container-fluid">
            <div class="row-fluid">
                <div class="span1"></div>
                <div class="span10">
<article>
<div class="row-fluid">
    <header class="page-header span10 offset2">
    <h1><a href="/scraping-javascript-pages-with-python-selenium.html"> Scraping JavaScript pages with Python: Selenium, Requests, and Beautiful Soup  </a></h1>
    </header>
</div>

<div class="row-fluid">
        <div class="span8 offset2 article-content">

            
            <p><strong>Note: Imgur has an API. Please use the API if you intend to gather
images from Imgur.</strong></p>
<p>This post is a short demonstration of scraping JavaScript webpages that
are not possible to scrape with <a href="http://www.crummy.com/software/BeautifulSoup/">Beautiful
Soup</a> or
<a href="http://docs.python-requests.org/en/latest/">Requests</a> by themselves.
 While imgur has an API, the thought occurred that perhaps there are
many, many sites that do not have an API that need a good scraping. If
that is the case, how do you scrape them?
<a href="http://selenium-python.readthedocs.org/installation.html">Selenium</a>.
Lets dive in and I will show you:</p>
<p>First things first, import the modules that will be used. You will need
to install these I prefer to use the
<a href="https://www.continuum.io/downloads">Anaconda</a> Python distribution. The
managing of Python environments is not in the scope of this demo, so I
will leave the management of that to you. Suffice to say that you can
install requests and beautiful soup with conda. Selenium can be created
as a package then uploaded to Anaconda Cloud with Binstar and... well,
you can simply install Selenium with pip.</p>
<div class="highlight"><pre><span class="kn">import</span> <span class="nn">os</span>
<span class="kn">from</span> <span class="nn">selenium</span> <span class="kn">import</span> <span class="n">webdriver</span>
<span class="kn">from</span> <span class="nn">bs4</span> <span class="kn">import</span> <span class="n">BeautifulSoup</span>
<span class="kn">from</span> <span class="nn">requests</span> <span class="kn">import</span> <span class="n">get</span>
</pre></div>


<p>[line]<br />
Next, define where you want to store the images. This will store the
image in the present working directory or the directory where the script
lives.</p>
<div class="highlight"><pre><span class="c"># Make a directory in the pwd, if one already exists. Cool.</span>
<span class="n">os</span><span class="o">.</span><span class="n">makedirs</span><span class="p">(</span><span class="s">&#39;imgur&#39;</span><span class="p">,</span> <span class="n">exist_ok</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span> <span class="c"># Make directory to store the images</span>
</pre></div>


<p>[line]<br />
Now we can instantiate the Selenium webdriver, and pass a url to fetch.
I used firefox because it seems like it is very well supported. I didn't
even try with Chrome which is my browser of choice.</p>
<div class="highlight"><pre><span class="c"># Imgur is not possible to scrape without Selenium. Because Javascript.</span>
<span class="n">browser</span> <span class="o">=</span> <span class="n">webdriver</span><span class="o">.</span><span class="n">Firefox</span><span class="p">()</span> <span class="c"># Instantiate a webdriver object</span>
<span class="n">browser</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&#39;http://imgur.com&#39;</span><span class="p">)</span> <span class="c"># Go to Imgur</span>
</pre></div>


<p>[line]<br />
This is where your investigation begins. First, define an empty list to
hold the links of the pages. Turns out that imgur renders the home page
with thumbnails of images. The links to the pages where the main image
src resides is within the class image-list-link. Every website is
different and rendered JavaScript pages can use wildly different naming
conventions. Thus the need to dig with your browser before you start
coding.  To investigate with a OSX, tune your browser (chrome) to the
url you wish to scrape and press: option | command | j  Then start
inspecting elements.</p>
<div class="highlight"><pre><span class="c"># Makes list of links to get full image</span>
<span class="n">links</span> <span class="o">=</span> <span class="p">[]</span>
<span class="c"># This is the container of images on the main page</span>
<span class="n">cards</span> <span class="o">=</span> <span class="n">browser</span><span class="o">.</span><span class="n">find_elements_by_class_name</span><span class="p">(</span><span class="s">&#39;image-list-link&#39;</span><span class="p">)</span>
<span class="k">for</span> <span class="n">img_src</span> <span class="ow">in</span> <span class="n">cards</span><span class="p">:</span>
    <span class="c"># Now assemble list to pass to requests and beautifulsoup</span>
    <span class="n">links</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">img_src</span><span class="o">.</span><span class="n">get_attribute</span><span class="p">(</span><span class="s">&#39;href&#39;</span><span class="p">))</span>
</pre></div>


<p>[line]<br />
The rest of the story. This bit of code loops through the links list
created in the previous snippet. We call requests.get() to url stored in
links list. Then we pass the html from requests to beautiful soup where
we can dominate it with reckless abandon. We ask soup to select the
post-image class img tag. Then we check if it is empty. If the list is
not empty, we assign the actual src of the imageLink to imageUrl. This
variable is prefixed with http: and sent back to requests for retrieval.
 If the url is mangled or mistyped we handle the exception and move to
the next one. If not, we write the file to directory and using requests
iter_chunks method in 100,000 byte increments. Close the image file and
start the next round or finish the script.</p>
<div class="highlight"><pre><span class="c"># loop through the links list (I&#39;m slicing to 5)</span>
<span class="k">for</span> <span class="n">page</span> <span class="ow">in</span> <span class="n">links</span><span class="p">[:</span><span class="mi">5</span><span class="p">]:</span>
    <span class="n">res</span> <span class="o">=</span> <span class="n">requests</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">page</span><span class="p">)</span>
    <span class="n">res</span><span class="o">.</span><span class="n">raise_for_status</span><span class="p">()</span>
    <span class="n">soup</span> <span class="o">=</span> <span class="n">BeautifulSoup</span><span class="p">(</span><span class="n">res</span><span class="o">.</span><span class="n">text</span><span class="p">,</span> <span class="s">&#39;html.parser&#39;</span><span class="p">)</span>
    <span class="n">imageLink</span> <span class="o">=</span> <span class="n">soup</span><span class="o">.</span><span class="n">select</span><span class="p">(</span><span class="s">&#39;.post-image img&#39;</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">imageLink</span> <span class="o">==</span> <span class="p">[]:</span>
        <span class="k">print</span><span class="p">(</span><span class="s">&#39;Nothing here...&#39;</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="c"># assign imageUrl hold the actual file name of the image</span>
            <span class="n">imageUrl</span> <span class="o">=</span> <span class="n">imageLink</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&#39;src&#39;</span><span class="p">)</span>
            <span class="c">#Download the image</span>
            <span class="k">print</span><span class="p">(</span><span class="s">&#39;Downloading image </span><span class="si">%s</span><span class="s">...&#39;</span> <span class="o">%</span><span class="p">(</span><span class="n">imageUrl</span><span class="p">))</span>
            <span class="n">res</span> <span class="o">=</span> <span class="n">requests</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&#39;http:&#39;</span><span class="o">+</span><span class="n">imageUrl</span><span class="p">)</span>
            <span class="n">res</span><span class="o">.</span><span class="n">raise_for_status</span><span class="p">()</span>
        <span class="k">except</span> <span class="n">requests</span><span class="o">.</span><span class="n">exceptions</span><span class="o">.</span><span class="n">MissingSchema</span><span class="p">:</span>
            <span class="k">continue</span>
        <span class="n">imageFile</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="s">&#39;imgur&#39;</span><span class="p">,</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">basename</span><span class="p">(</span><span class="n">imageUrl</span><span class="p">)),</span> <span class="s">&#39;wb&#39;</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">chunk</span> <span class="ow">in</span> <span class="n">res</span><span class="o">.</span><span class="n">iter_content</span><span class="p">(</span><span class="mi">100000</span><span class="p">):</span>
            <span class="n">imageFile</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">chunk</span><span class="p">)</span>
        <span class="n">imageFile</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
</pre></div>
            
            
            <hr/>
        </div>
        <section>
        <div class="span2" style="float:right;font-size:0.9em;">
            <h4>Published</h4>
            <time pubdate="pubdate" datetime="2015-12-03T23:08:00-07:00">Dec 3, 2015</time>
            <h4>Category</h4>
            <a class="category-link" href="/categories.html#python-ref">Python</a>
            <h4>Tags</h4>
            <ul class="list-of-tags tags-in-article">
                <li><a href="/tags.html#beautifulsoup-ref">BeautifulSoup
                    <span>1</span>
</a></li>
                <li><a href="/tags.html#javascript-ref">Javascript
                    <span>5</span>
</a></li>
                <li><a href="/tags.html#requests-ref">Requests
                    <span>1</span>
</a></li>
                <li><a href="/tags.html#scraping-ref">Scraping
                    <span>1</span>
</a></li>
                <li><a href="/tags.html#selenium-ref">Selenium
                    <span>1</span>
</a></li>
            </ul>
<h4>Contact</h4>
    <a href="#" title="My You can add links in your config file Profile" class="sidebar-social-links" target="_blank">
    <i class="fa fa-you can add links in your config file sidebar-social-links"></i></a>
    <a href="#" title="My Another social link Profile" class="sidebar-social-links" target="_blank">
    <i class="fa fa-another social link sidebar-social-links"></i></a>
        </div>
        </section>
</div>
</article>
                </div>
                <div class="span1"></div>
            </div>
        </div>
        <div id="push"></div>
    </div>
<footer>
<div id="footer">
    <ul class="footer-content">
        <li class="elegant-power">Powered by <a href="http://getpelican.com/" title="Pelican Home Page">Pelican</a>. Theme: <a href="http://oncrashreboot.com/pelican-elegant" title="Theme Elegant Home Page">Elegant</a> by <a href="http://oncrashreboot.com" title="Talha Mansoor Home Page">Talha Mansoor</a></li>
    </ul>
</div>
</footer>            <script src="http://code.jquery.com/jquery.min.js"></script>
        <script src="//netdna.bootstrapcdn.com/twitter-bootstrap/2.3.2/js/bootstrap.min.js"></script>
        <script>
            function validateForm(query)
            {
                return (query.length > 0);
            }
        </script>

    
    </body>
    <!-- Theme: Elegant built for Pelican
    License : http://oncrashreboot.com/pelican-elegant -->
</html>